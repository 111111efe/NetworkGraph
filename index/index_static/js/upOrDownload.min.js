var upload_layout=d3.select("#upload-layout");d3.select("#upload-data").on("click",function(){upload_layout.style("display","block")});var offset_x,offset_y,isdown=false;upload_layout.select("#upload-top-layout").on("mousedown",function(){offset_x=event.pageX-this.parentNode.offsetLeft;offset_y=event.pageY-this.parentNode.offsetTop;isdown=true;d3.select("#svg").on("mousemove.move-upload-layout",function(){if(isdown){upload_layout.style("left",d3.event.pageX-offset_x+"px");upload_layout.style("top",d3.event.pageY-offset_y+"px")}})}).on("mouseup",function(){isdown=false}).on("mousemove",function(){if(isdown){upload_layout.style("left",event.pageX-offset_x+"px");upload_layout.style("top",event.pageY-offset_y+"px")}});d3.select("#close-button").on("click",function(){upload_layout.style("display","none")});d3.select("#file-close").on("click",function(){upload_layout.style("display","none")});d3.select("#select-file").on("click",function(){document.getElementById("file-input").click()});d3.select("#file-input").on("input propertychange",function(){d3.select("#file-name").text(this.value);d3.select("file-state").text("等待上传")});d3.select("#upload-button").on("click",function(){var e=new FormData;var t=$("#file-input")[0].files[0];e.append("file",t);$.ajax({url:"upload",type:"POST",data:e,async:false,contentType:false,processData:false,success:function(e){data=JSON.parse(e);updateData(data);d3.select("#upload-layout").style("display","none");d3.select("#file-name").text(this.value);d3.select("file-state").text("等待上传")},error:function(){alert("数据上传失败！")}})});d3.select("#download-data").on("click",downFile);function downFile(){var e=JSON.parse(JSON.stringify(data));e.nodes.forEach(function(e){delete e.index;delete e.x;delete e.y;delete e.vx;delete e.vy;delete e.selected;delete e.previouslySelected});e.links.forEach(function(e){delete e.index;e.source=e.source.id;e.target=e.target.id});var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+JSON.stringify(e,null,4));t.setAttribute("download","data.json");t.style.display="none";document.body.appendChild(t);t.click();document.body.removeChild(t)}d3.select("#download-img").on("click",function(){saveSvgAsPng(document.getElementById("container"),"networkGraph.png")});